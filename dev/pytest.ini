# pytest.ini
[pytest]
# --------------------------------------------------------------------
# Serger test configuration
# We use pytest.ini instead of pyproject.toml because 
#  of the large amount of norecursedirs and not wanting
#  pyproject.toml to just be pages of ignores from each
#  tool.
# --------------------------------------------------------------------

# Root test path
testpaths = tests

markers =
	slow: marks tests as slow (deselect with '-m "not slow"')
	debug: marks tests as debug-only (skipped by default unless -k debug)

# Don't recurse into generated or build output directories
norecursedirs =
    dist
    tmp-dist
    tmp
    out
    bin
    build
    .git
    .venv
    .cache
    __pycache__

# Add src/ to sys.path for imports
pythonpath = src

# Show more context in assertion diffs (-s needed for early prints)
# Exclude pocket-build compatibility tests (to be migrated in Phase 5+6)
# Parallel execution: use -n auto to auto-detect CPU count, or -n N for N workers
# Note: parallel execution is opt-in via command line (not in addopts) to avoid
# issues with test isolation and shared resources
addopts = -ra -q --color=yes --show-capture=all --tb=short

# Timeout configuration (pytest-timeout plugin)
# Per-test timeout: 60 seconds
timeout = 60
timeout_func_only = false

# Suppress pytest-benchmark warnings when running with xdist (parallel tests)
# Benchmarks are automatically disabled in parallel mode, which is expected
filterwarnings =
    ignore:Benchmarks are automatically disabled because xdist plugin is active:pytest.PytestWarning
